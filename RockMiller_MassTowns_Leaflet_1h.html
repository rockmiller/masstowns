<!DOCTYPE html>
<html>
<title>Massachusetts Settlements (Rock Miller)</title>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<style>
    .leaflet-container {
    background-color:rgba(255,0,0,0.0);
}
</style>
<head>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

 <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
 integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
 crossorigin=""/>

 <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
     integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
     crossorigin=""></script>

<script src="https://unpkg.com/leaflet-providers@latest/leaflet-providers.js"></script>

</head>
<body>
<h3>Massachusetts Settlements</h3>

<div id="map"></div>
<style>
#map { height: 600px; }
</style>

<script>
var map = L.map('map').setView([42.26259, -71.80229],8);
console.log(map);

var base = L.tileLayer('https://tiles.stadiamaps.com/tiles/stamen_terrain_background/{z}/{x}/{y}{r}.{ext}?api_key=166a8804-2976-4723-9652-33257ce7d1e6', {
	minZoom: 6,
	maxZoom: 9,
  opacity: 0.5,
	attribution: '&copy; <a href="https://www.stadiamaps.com/" target="_blank">Stadia Maps</a> &copy; <a href="https://www.stamen.com/" target="_blank">Stamen Design</a> &copy; <a href="https://openmaptiles.org/" target="_blank">OpenMapTiles</a> &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
	ext: 'png'
}).addTo(map);
console.log(base);
</script>

<script>

  function onEachFeatureFn(feature, layer) {
        var popupContent = '<p>' +
          feature.properties.m_name+
          '</br>'+
          feature.properties.m_yrsettled+
          '</p>';
        console.log(popupContent);
        /*
        if (feature.properties && feature.properties.m_name) {
          popupContent += feature.properties.m_name;
        }
*/
        layer.bindPopup(popupContent, { autoPan: false });

        layer.on({
          click: function (e) {
            //e.target.setStyle({ fillColor: "lightyellow" });
            console.log(e)
            e.target.openPopup();
          },
          mouseover: function (e) {
            ///e.target.setStyle({ fillColor: "white" });
            e.target.openPopup();
          },
          mouseout: (e) => {
            //USstatesLayer.resetStyle(e.target);
            e.target.closePopup();
          },
        });
      }

</script>

<div id="towns"></div>
<script>
const fetch2 = fetch("https://raw.githubusercontent.com/rockmiller/masstowns/main/mass_state_border.geojson");
fetch2.then(response => {
  return response.json();
}).then(bordersState => {
  console.log(bordersState);
  L.geoJSON(bordersState, { style: {'color':'black', 'weight': 1, 'fillOpacity':0}}).addTo(map)});

const fetchPromise = fetch("https://raw.githubusercontent.com/rockmiller/masstowns/main/mass_towns_points.geojson");
fetchPromise.then(response => {
  return response.json();
}).then(points => {
  console.log(points);
  
  var pointStyleDefault = {
    radius: 1.5,
    fillColor: 'grey',
    color: 'grey',
    weight: 1,
    opacity: 1,
    fillOpacity: 1
};
var pointStyleCase2 = {
    radius: 4,
    fillColor: 'khaki',
    color: 'indianred',
    weight: 1.2,
    opacity: 1,
    fillOpacity: 1
};
var masstowns = L.geoJSON(points, {
  pointToLayer: function(feature, latlng) {
    yr = feature.properties.m_yrsettled
    if (yr <= 1675) return L.circleMarker(latlng, pointStyleCase2)
    else return L.circleMarker(latlng, pointStyleDefault)},
  onEachFeature: onEachFeatureFn,}).addTo(map)});
</script>
</body>
</html>